{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MarketMorph</title>
    <link
      rel="shortcut icon"
      href="{% static 'logo1.ico' %}"
      type="image/x-icon"
    />
    <!-- <link rel="stylesheet" href="customerForm.css" /> -->
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'customerForm.css' %}"
    />
    <link rel="stylesheet" type="text/css" href="{% static 'Navbar.css' %}" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- <link rel="stylesheet" href="Navbar.css" /> -->
  </head>
  <body>
    <div class="navbar-container">
      <div class="nav" id="navbar">
        <div class="nav-left">
          <a href="/">
            <div class="nav-logo">
              <img src="{% static 'logo1.png' %}" alt="" />
            </div>
          </a>
        </div>
      </div>
    </div>
    <div class="customerForm-mainContainer">
      <div class="customerForm-container">
        <div class="customerForm-title">
          <h1>Wanna get recommendations of relevant products?</h1>
          <p>Fill the form below and we will recommend you the best products</p>
        </div>
        <hr />
        <!-- {% if result %} -->
        <!-- <h1>Flower you're trying to classify is {{result}}</h1> -->
        <!-- {% endif %} -->
        <div class="customerForm-form">
          <form id="product-form" action="" method="POST">
            {% csrf_token %}
            <div class="customer-id">
              <label>Customer Id</label>
              <!--Id-->
              <input
                type="text"
                id="customerId-input"
                placeholder="ID"
                required
              />
            </div>
            <div class="customer-location">
              <div class="customerForm-input">
                <label for="location">Location </label>
                <p>Enter your current locating country</p>
                <!--Lo-->
                <select name="location" required>
                  <option value="International">International</option>
                  <option value="United Kingdom">United Kingdom</option>
                </select>
              </div>
            </div>
            <div class="customer-time">
              <label for="date-time-input">Select a date and time</label>
              <!--Da-->
              <input
                type="datetime-local"
                id="date-time-input"
                name="date-time"
                max="2011-12-09T12:50:00"
                min="2010-12-01T08:26:00"
                required
              />
            </div>
            <div class="products-optionContainer" id="products-optionContainer">
              <h1>Products</h1>
              <p>
                Enter any 1 product with its corresponding quantity and get
                relatable product recommendations.
              </p>
              <input type="text" id="search-input" placeholder="Search..." />
              <!--Pr-->
              <div id="product-list">
                <!--Qu-->
              </div>
            </div>
            <button
              id="submit-btn"
              type="submit"
              onclick="onSubmit()"
            >
              Submit
            </button>
          </form>
        </div>
      </div>
    </div>
    <script>
      products = [];
      fetch("{% static 'product.csv' %}")
        .then((response) => response.text())
        .then((data) => {
          products = data.split("\n").map((name) => name.trim());
        })
        .then(() => {
          // console.log(products);
          amount = product[0];
        });
      // console.log(products);
      let values = [];
      fetch("{% static 'product.csv' %}")
        .then((response) => response.text())
        .then((data) => {
          values = data.split("\n").map((name) => name.trim());
          // console.log(values);
        });
      console.log(values);
      // Get the search input element and products container element
      const searchInput = document.getElementById("search-input");
      const productsContainer = document.getElementById("product-list");

      // Function to generate HTML for a product label and input field
      function generateProductHTML(product) {
        const productLabel = document.createElement("label");
        const productDiv1 = document.createElement("div");
        const productInput = document.createElement("input");
        const productDiv2 = document.createElement("div");
        const quantityInput = document.createElement("input");

        productInput.setAttribute("type", "checkbox");
        productInput.setAttribute("value", product);
        productInput.setAttribute("name", product);
        productInput.setAttribute("required", true);

        productDiv1.classList.add("customerForm-radio");
        productDiv1.appendChild(productInput);
        productDiv1.appendChild(document.createTextNode(product));

        quantityInput.setAttribute("type", "number");
        quantityInput.setAttribute("name", product);
        quantityInput.setAttribute("placeholder", "Quantity");
        quantityInput.setAttribute("min", 0);
        quantityInput.setAttribute("required", true);

        productDiv2.classList.add("customerForm-quantity");
        productDiv2.appendChild(quantityInput);

        productLabel.appendChild(productDiv1);
        productLabel.appendChild(productDiv2);

        return productLabel;
      }

      // Function to display products based on the search input
      function displayProducts() {
        // Clear the products container
        while (productsContainer.firstChild) {
          productsContainer.removeChild(productsContainer.firstChild);
        }

        // Get the search query
        const query = searchInput.value.toLowerCase();

        // Filter the products array based on the search query
        const filteredProducts = products.filter((product) =>
          product.toLowerCase().includes(query)
        );

        // Display the first 10 products if the search query is empty
        const productsToDisplay = query
          ? filteredProducts
          : filteredProducts.slice(0, 10);

        // Generate HTML for each product and append it to the products container
        productsToDisplay.forEach((product) => {
          const productHTML = generateProductHTML(product);
          productsContainer.appendChild(productHTML);
        });
      }

      // Display products on page load
      displayProducts();

      // Add event listener for the search input to display products based on search query
      searchInput.addEventListener("input", displayProducts);

      productsContainer.addEventListener("change", function (event) {
        const checkboxes = productsContainer.querySelectorAll(
          'input[type="checkbox"]'
        );
        const productHTML = event.target.closest("label");
        const quantityInput = productHTML.querySelector(
          ".customerForm-quantity input[type='number']"
        );
        const quantityValue = quantityInput.value;
        const selectedProducts = [];
      //   checkboxes.forEach(function (checkbox) {
      //     if (checkbox.checked) {
      //       selectedProducts.push(checkbox.value);
      //     }
      //   });
      //   console.log(selectedProducts[0]);
      //   console.log(quantityValue);
      //   // sendVariableValueToDjango(selectedProducts[0], quantityValue);
      //   return selectedProducts[0], quantityValue;
      });
      const product = checkboxes.forEach(function(checkbox){
        if (checkbox.checked) {
          selectedProducts.push(checkbox.value);
        }
        return selectedProducts[0];
      });
        
      console.log(product(checkboxes));
      function onSubmit() {
        
        console.log(checkboxes)
        sendVariableValueToDjango(selectedProducts[0], quantityValue);
      }

      function sendVariableValueToDjango(product, quantity) {
        $.ajax({
          url: "{% url 'django_view_name' %}",
          type: "POST",
          data: {
            product_name: product,
            quantity: quantity,
            csrfmiddlewaretoken: "{{ csrf_token }}",
          },
          success: function (response) {
            // Handle the response from Django, if needed
          },
        });
      }
    </script>
    <!-- <script src="customerForm.js"></script> -->
  </body>
</html>
